- name: start
  cmd: |
    set -ue

    echo Dynamic workflow that will add tasks to the DAG while its running


- name: add_tasks
  after: start
  exec: |
    runner.workflow.new_task(
        name='dynamic_task',
        cmd='sleep 1 && echo This is the dynamic task && sleep 1'
    )


- name: after_adding_tasks
  after: add_tasks
  cmd: |
    set -ue

    echo The final workflow should have 5 tasks total


- name: after_dynamic_task
  after:
    re: dynamic_task|after_adding_tasks
  cmd: |
    echo This should have run after \"dynamic_task\"

